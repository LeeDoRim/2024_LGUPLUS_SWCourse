<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <h1>Home</h1>
    <hr>
    <div id="name"></div>
    <div id="role"></div>
    <button id="btnLogout">Logout</button>
    <hr>
    <a href="/login.html">ë¡œê·¸ì¸</a>
    <a href="/register.html">íšŒì›ê°€ì…</a>
    <hr>
    <a href="/productlist.html">íšŒì› ìƒí’ˆ ì¡°íšŒ</a> <br>
    <a href="/orderinsert.html">íšŒì› ìƒí’ˆ ì£¼ë¬¸</a><br>
    <a href="/userupdate.html">íšŒì› ì •ë³´ ìˆ˜ì •</a><br>
    <hr>
    <a href="/test.html">ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ í˜ì´ì§€</a>
    <hr>
    <a href="/admin.html">ê´€ë¦¬ì í˜ì´ì§€</a>

    <script>
        window.onload = function () {

            let userDto = JSON.parse(sessionStorage.getItem("userDto")); // json string -> js object
            if (userDto) {
                document.querySelector("#name").innerHTML = userDto.name + " íšŒì›ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤. ğŸ˜Š";

                let roleHtml = "ë“±ê¸‰: ";

                Object.values(userDto.roles).forEach(role => roleHtml += role + ", ");
                document.querySelector("#role").innerHTML = roleHtml;
            }

            document.querySelector("#btnLogout").onclick = logout;
        }

        async function logout() {
            let url = "/users/logout";

            let response = await fetch(url); // json
            let data = await response.json(); // js object

            if (data.result == "success") {
                sessionStorage.removeItem("userDto");
                document.querySelector("#name").innerHTML = "";
                document.querySelector("#role").innerHTML = "";
                alert("ë¡œê·¸ì•„ì›ƒì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.");
            } else if (data.result == "fail") {
                alert("ë¡œê·¸ì•„ì›ƒ ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        }

    </script>
</body>
</html>