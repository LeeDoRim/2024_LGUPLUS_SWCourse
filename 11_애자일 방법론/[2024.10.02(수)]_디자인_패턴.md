# [2024.10.02(수)] 디자인 패턴


# Decorator

## Car.java

```java
package decorator;

// Component
public interface Car {
	String getDescription();
	int getSpeed();
}
```

## simpleCar.java

```java
package decorator;

// Concrete Component
public class simpleCar implements Car {

	@Override
	public String getDescription() {
		return "Simple Car";
	}

	@Override
	public int getSpeed() {
		return 80;
	}

}
```

## CarDecorator.java

```java
package decorator;

// Decorator
public abstract class CarDecorator implements Car {
	protected Car decoratedCar;
	
	public CarDecorator(Car car) {
		this.decoratedCar = car;
	}
	
	@Override
	public String getDescription() {
		return decoratedCar.getDescription();
	}
	
	@Override
	public int getSpeed() {
		return decoratedCar.getSpeed();
	}
}
```

## TruckDecorator.java

```java
package decorator;

// Concrete Decorator
public class TruckDecorator extends CarDecorator {

	public TruckDecorator(Car car) {
		super(car);
	}
	
	@Override
	public String getDescription() {
		return super.getDescription() + "트럭으로 변경했습니다.";
	}
	
	@Override
	public int getSpeed() {
		return super.getSpeed() + 10;
	}

}
```

## SuperCarDecorator.java

```java
package decorator;

// Concrete Decorator
public class TruckDecorator extends CarDecorator {

	public TruckDecorator(Car car) {
		super(car);
	}
	
	@Override
	public String getDescription() {
		return super.getDescription() + "트럭으로 변경했습니다.";
	}
	
	@Override
	public int getSpeed() {
		return super.getSpeed() + 10;
	}

}
```

## Test.java

```java
package decorator;

public class Test {

	public static void main(String[] args) {
		Car car = new simpleCar();
		System.out.println("이 차는 " + car.getDescription());
		System.out.println("이 차의 속도는 " + car.getSpeed());
		
		Car car2 = new simpleCar();
		car2 = new TruckDecorator(car2);
		System.out.println("이 차는 " + car2.getDescription());
		System.out.println("이 차의 속도는 " + car2.getSpeed());
		
		Car car3 = new simpleCar();
		car3 = new SuperCarDecorator(car3);
		System.out.println("이 차는 " + car3.getDescription());
		System.out.println("이 차의 속도는 " + car3.getSpeed());
		
	}
	
}
```

# templatemethod

## OldShef.java

```java
package templatemethod;

public class OldShef extends Shef{

	@Override
	void prepareMaterials() {
		System.out.println("OldShef : prepareMaterials()");
	}
	
	@Override
	void fallowRecepies() {
		System.out.println("OldShef : fallowRecepies()");
	}
	
	@Override
	void offerFoods() {
		System.out.println("OldShef : offerFoods()");
	}
	
}
```

## YoungShef.java

```java
package templatemethod;

public class YoungShef extends Shef {

	@Override
	void prepareMaterials() {
		System.out.println("YoungShef : prepareMaterials()");
	}
	
	@Override
	void fallowRecepies() {
		System.out.println("YoungShef : fallowRecepies()");
	}
	
	@Override
	void offerFoods() {
		System.out.println("YoungShef : offerFoods()");
	}
	
}
```

## Shef.java

```java
package templatemethod;

public abstract class Shef {
	
	public final void cook() {
		// 아래 메소드 호출 순서(지켜야할) 대로 호출
		prepareMaterials();
		fallowRecepies();
		offerFoods();
	}
	
	abstract void prepareMaterials();
	abstract void fallowRecepies();
	abstract void offerFoods();

}
```

## Test.java

```java
package templatemethod;

public class Test {

	public static void main(String[] args) {
		OldShef oldShef = new OldShef();
		YoungShef youngShef = new YoungShef();
		
		youngShef.cook();
		oldShef.cook();
		
	}
	
}
```

# Proxy

## Car.java

```java
package proxy;

public interface Car {
	void engineStart();
	void drive();
}
```

## SimpleCar.java

```java
package proxy;

public class SimpleCar implements Car {

	@Override
	public void engineStart() {
		System.out.println("SimpleCar : engineStart");
	}

	@Override
	public void drive() {
		System.out.println("SimpleCar : drive");
	}

}
```

## ProxyCar.java

```java
package proxy;

public class ProxyCar implements Car {

	private SimpleCar simpleCar;
	
	@Override
	public void engineStart() {
		System.out.println("ProxyCar : engineStart");
	}

	@Override
	public void drive() {
		System.out.println("ProxyCar : drive");
		
		if(simpleCar == null) { // lazy loding
			simpleCar = new SimpleCar();
			simpleCar.engineStart(); // 공회전 해결
		}
		simpleCar.drive();
	}

}
```

## Test.java

```java
package proxy;

public class Test {

	public static void main(String[] args) {
		// #1
//		Car car = new SimpleCar();
//		car.engineStart();
//		
//		// 일정 시간 ... 공회전
//		try {
//			Thread.sleep(3000);
//		} catch(Exception e) {
//			e.printStackTrace();
//		}
//		
//		car.drive();
		
		
		// #2
		Car car = new ProxyCar();
		car.engineStart();
		
		// 일정 시간 ... 공회전
		try {
			Thread.sleep(3000);
		} catch(Exception e) {
			e.printStackTrace();
		}
		
		car.drive();
	}
	
}
```

## 실제 Proxy를 만드는 방법

### CarInvocationHandler.java

```java
package proxy;

import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;

public class CarInvocationHandler implements InvocationHandler {
    private Object car;
    public CarInvocationHandler(Object car) {
        this.car = car;
    
    }
    
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        System.out.println("Proxy: Before invoking " + method.getName());
        // 실제 객체의 메서드를 호출
        Object result = method.invoke(car, args);
        System.out.println("Proxy: After invoking " + method.getName());
        
        return result;
    }

}
```

### Test.java

```java
package proxy;

import java.lang.reflect.Proxy;

public class Test {

	public static void main(String[] args) {
		// #1
//		Car car = new SimpleCar();
//		car.engineStart();
//		
//		// 일정 시간 ... 공회전
//		try {
//			Thread.sleep(3000);
//		} catch(Exception e) {
//			e.printStackTrace();
//		}
//		
//		car.drive();
		
		
		// #2
//		Car car = new ProxyCar();
//		car.engineStart();
//		
//		// 일정 시간 ... 공회전
//		try {
//			Thread.sleep(3000);
//		} catch(Exception e) {
//			e.printStackTrace();
//		}
//		
//		car.drive();
		
		// #3 proxy 객체
		Car car = getCar();
		car.engineStart();
		car.drive();
	}
	
	static Car getCar() {
        
        Car car = new SimpleCar();
        
        // #1 simpleCar
//        return car;
        
        // #2 proxy
        return (Car) Proxy.newProxyInstance(
                SimpleCar.class.getClassLoader(),        // 클래스 로더
                new Class[] { Car.class },                  // 프록시가 구현할 인터페이스
                new CarInvocationHandler(car)         // InvocationHandler
            );
    }
	
}
```